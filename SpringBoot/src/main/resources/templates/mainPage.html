<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Главная страница</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link th:href="@{/css/mainPage-styles.css}" rel="stylesheet">
    <link th:href="@{/css/navbar-styles.css}" rel="stylesheet">

    <script th:src="@{/js/mainPage.js}" defer></script>
</head>
<body>
<div th:replace="~{fragments/navbar :: navbar}"></div>

<!-- Main Content -->
<main class="main-container">
    <h1 class="page-title">Список постов</h1>

    <!-- Success Message -->
    <div th:if="${success}" class="success-message" th:text="${success}"></div>

    <!-- Error Message -->
    <div th:if="${error}" class="error-message" th:text="${error}"></div>

    <!-- Форма поиска и фильтров -->
    <div class="filters-container">
        <form th:action="@{/}" method="get" class="filters-form">

            <!-- Поиск по названию -->
            <div class="search-box">
                <i class="fas fa-search search-icon"></i>
                <input
                        type="text"
                        name="title"
                        th:value="${param.title}"
                        placeholder="Поиск по названию..."
                        class="search-input"
                >
            </div>

            <!-- Фильтры -->
            <div class="filters-grid">

                <!-- Игра -->
                <div class="filter-group">
                    <label for="game">
                        <i class="fas fa-gamepad"></i>
                        Игра
                    </label>
                    <select name="game" id="game" class="filter-select">
                        <option value="">Все</option>
                        <option th:each="g : ${games}"
                                th:value="${g}"
                                th:text="${g}"
                                th:selected="${param.game != null && param.game[0] == g}">
                        </option>
                    </select>
                </div>

                <!-- Часы от -->
                <div class="filter-group">
                    <label for="hoursFrom">
                        <i class="fas fa-calendar"></i>
                        Часы от
                    </label>
                    <input
                            type="number"
                            name="hoursFrom"
                            id="hoursFrom"
                            th:value="${param.hoursFrom}"
                            placeholder="0"
                            class="filter-input"
                    >
                </div>

                <!-- Часы до -->
                <div class="filter-group">
                    <label for="hoursTo">
                        <i class="fas fa-calendar-check"></i>
                        Часы до
                    </label>
                    <input
                            type="number"
                            name="hoursTo"
                            id="hoursTo"
                            th:value="${param.hoursTo}"
                            placeholder="30000"
                            class="filter-input"
                    >
                </div>
            </div>

            <!-- Кнопки -->
            <div class="filter-actions">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-search"></i>
                    Применить фильтры
                </button>
                <a th:href="@{/}" class="btn btn-secondary">
                    <i class="fas fa-times"></i>
                    Сбросить
                </a>
            </div>
        </form>
    </div>

    <!-- Create Post Button -->
    <div class="create-post-section" th:if="${name}">
        <a th:href="@{/create-post}" class="btn btn-primary">
            <i class="fas fa-plus"></i>
            Создать пост
        </a>
    </div>

    <!-- Posts List -->
    <div th:if="${posts != null and !posts.isEmpty()}" class="post-list">
        <article th:each="post : ${posts}" class="post-item">
            <div class="post-header">
                <div>
                    <h3 class="post-title" th:text="${post.title}">Название поста</h3>
                    <div class="post-game">
                        <i class="fas fa-gamepad"></i>
                        <span th:text="${post.game}">Игра</span>
                    </div>
                </div>
            </div>

            <div class="post-meta">
                <div class="post-author">
                    <div class="post-author-avatar" th:text="${post.player.name != null ? post.player.name.substring(0,1).toUpperCase() : 'U'}">U</div>
                    <span th:text="${post.player.name ?: 'Игрок'}">Имя игрока</span>
                </div>
                <div class="post-stat">
                    <i class="fas fa-clock"></i>
                    <span th:text="${post.quantityOfHours} + ' ч'">0 ч</span>
                </div>
                <div class="post-stat">
                    <i class="fas fa-calendar"></i>
                    <span th:text="${#temporals.format(post.createdAt, 'dd.MM.yyyy')}">Дата</span>
                </div>
            </div>

            <p class="post-description" th:text="${post.description ?: 'Без описания'}">
                Описание поста
            </p>

            <div class="post-footer">
                <div class="post-stats">
                    <!-- Дополнительные статистики можно добавить здесь -->
                </div>
                <div class="post-actions">
                    <a th:href="@{/post/{id}(id=${post.id})}" class="post-link">
                        Подробнее
                    </a>
                    <!-- Кнопка отклика (только для не-владельцев) -->
                    <form th:if="${currentPlayer != null and currentPlayer.id != post.player.id}"
                          th:action="@{/post/{id}/respond(id=${post.id})}"
                          method="post"
                          class="respond-form">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                        <button type="submit" class="btn btn-primary btn-respond">
                            <i class="fas fa-reply"></i>
                            Откликнуться
                        </button>
                    </form>
                    <!-- Для владельца поста показываем сообщение -->
                    <div th:if="${currentPlayer != null and currentPlayer.id == post.player.id}" class="owner-badge">
                        Ваш пост
                    </div>
                </div>
            </div>
        </article>
    </div>

    <!-- Empty State -->
    <div th:if="${posts == null or posts.isEmpty()}" class="empty-state">
        <i class="fas fa-gamepad"></i>
        <h3>Пока нет постов</h3>
        <p>Станьте первым, кто создаст пост для поиска товарищей по команде!</p>
        <a th:href="@{/create-post}" class="btn btn-primary" th:if="${name}" style="margin-top: 1rem;">
            <i class="fas fa-plus"></i>
            Создать первый пост
        </a>
    </div>
</main>


</body>
</html>